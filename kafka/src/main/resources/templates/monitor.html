<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/css/bootstrap/4.0.0/bootstrap.min.css">
    <link href="/css/bootstrap/3.0.1/bootstrap.min.css" rel="stylesheet">
    <link href="/css/v3/layoutit.css" rel="stylesheet">
    <!--<script src="/js/jquery-1.8.3.min.js"></script>-->
    <script src="/js/jquery-2.1.4.min.js"></script>
    <script src="/js/echarts.min.js"></script>
    <script src="/js/highchart.js"></script>
    <!--<script src="https://code.highcharts.com.cn/highcharts/highcharts.js" ></script>-->
    <!--<script src="https://code.highcharts.com.cn/highcharts/modules/exporting.js"></script>-->
    <!--<script src="https://img.hcharts.cn/highcharts-plugins/highcharts-zh_CN.js"></script>-->
</head>
<body>
<div class="container">
    <div class="row clearfix">
        <div class="col-md-12 column">
            <nav class="navbar navbar-default" role="navigation">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"> <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button> <a class="navbar-brand" href="#">Brand</a>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="#">Link</a>
                        </li>
                        <li>
                            <a href="#">Link</a>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown<strong class="caret"></strong></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="#">Action</a>
                                </li>
                                <li>
                                    <a href="#">Another action</a>
                                </li>
                                <li>
                                    <a href="#">Something else here</a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="#">Separated link</a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="#">One more separated link</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <form class="navbar-form navbar-left" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control" />
                        </div> <button type="submit" class="btn btn-default">Submit</button>
                    </form>
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#">Link</a>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown<strong class="caret"></strong></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="#">Action</a>
                                </li>
                                <li>
                                    <a href="#">Another action</a>
                                </li>
                                <li>
                                    <a href="#">Something else here</a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="#">Separated link</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>

            </nav>

            <div class="row clearfix">
                <div class="col-md-2 column">
                    <button type="button" class="btn btn-primary btn-lg btn-block">按钮</button>
                    <button type="button" class="btn btn-primary btn-lg btn-block">按钮</button>
                </div>

                <div class="col-md-10 column">
                    <div id="real" style="height:500px;border:1px solid #ccc;padding:10px;"></div>
                    <script>
                        Highcharts.setOptions({
                            global: {
                                timezoneOffset: -8 * 60
                            }
                        });

                        var chartReal = Highcharts.chart('real', {
                            chart: {
                                type: 'spline'
                            },
                            title: {
                                text: '实时监控'
                            },
                            credits: {
                                enabled: false
                            },
                            xAxis: {
                                type: 'datetime'//,
                                // data: ["","","","","","","","","",""]
                            },
                            yAxis: {
                                title: {
                                    text: 'm'
                                },
                                min: 20,
                                max: 100,
                                plotBands: [{ // Light air
                                    from: 80,
                                    to: 90,
                                    color: 'rgba(255, 185, 15, 0.1)',
                                    label: {
                                        text: '预警水位',
                                        style: {
                                            color: '#8B8989'
                                        }
                                    }
                                }, { // Light air
                                    from: 90,
                                    to: 100,
                                    color: 'rgba(255, 69, 0, 0.1)',
                                    label: {
                                        text: '危险水位',
                                        style: {
                                            color: '#8B8989'
                                        }
                                    }
                                }]
                            },
                            tooltip: {
                                valueSuffix: ' m'
                            },
                            series: [{
                                name: 'HoHai',
                                data: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                            }]
                        });

                        var updateChartReal = function (data){

                            chartReal.hideLoading();

                            // 准备数据
                            var timestamp = parseInt(data.time);  //获取时间戳
                            var date = new Date(timestamp);     //将时间戳转为Date
                            var waterLevel = parseFloat(data.waterLevel);
                            // var location = data.siteName;

                            // 更新数据
                            // console.log("timestamp = " + timestamp + " waterLevel = " + waterLevel);
                            chartReal.series[0].addPoint([timestamp, waterLevel], true, true);

                        }

                    </script>
                </div>
            </div>

            <div class="jumbotron">


                <!--<div id="real" style="height:500px;border:1px solid #ccc;padding:10px;"></div>-->
                <!--<script>-->
                    <!--Highcharts.setOptions({-->
                        <!--global: {-->
                            <!--timezoneOffset: -8 * 60-->
                        <!--}-->
                    <!--});-->

                    <!--var chartReal = Highcharts.chart('real', {-->
                        <!--chart: {-->
                            <!--type: 'spline'-->
                        <!--},-->
                        <!--title: {-->
                            <!--text: '实时监控'-->
                        <!--},-->
                        <!--credits: {-->
                            <!--enabled: false-->
                        <!--},-->
                        <!--xAxis: {-->
                            <!--type: 'datetime',-->
                            <!--data: ["","","","","","","","","",""]-->
                        <!--},-->
                        <!--yAxis: {-->
                            <!--title: {-->
                                <!--text: 'm'-->
                            <!--},-->
                            <!--min: 20,-->
                            <!--max: 100,-->
                            <!--plotBands: [{ // Light air-->
                                <!--from: 80,-->
                                <!--to: 90,-->
                                <!--color: 'rgba(255, 185, 15, 0.1)',-->
                                <!--label: {-->
                                    <!--text: '预警水位',-->
                                    <!--style: {-->
                                        <!--color: '#8B8989'-->
                                    <!--}-->
                                <!--}-->
                            <!--}, { // Light air-->
                                    <!--from: 90,-->
                                    <!--to: 100,-->
                                    <!--color: 'rgba(255, 69, 0, 0.1)',-->
                                    <!--label: {-->
                                        <!--text: '危险水位',-->
                                        <!--style: {-->
                                            <!--color: '#8B8989'-->
                                        <!--}-->
                                    <!--}-->
                            <!--}]-->
                        <!--},-->
                        <!--tooltip: {-->
                            <!--valueSuffix: ' m'-->
                        <!--},-->
                        <!--// plotOptions: {-->
                        <!--//     spline: {-->
                        <!--//         lineWidth: 4,-->
                        <!--//         states: {-->
                        <!--//             hover: {-->
                        <!--//                 lineWidth: 5-->
                        <!--//             }-->
                        <!--//         },-->
                        <!--//         marker: {-->
                        <!--//             enabled: false-->
                        <!--//         },-->
                        <!--//         pointInterval: 3600000, // one hour-->
                        <!--//         pointStart: Date.UTC(2009, 9, 6, 0, 0, 0)-->
                        <!--//     }-->
                        <!--// },-->
                        <!--series: [{-->
                            <!--name: 'HoHai',-->
                            <!--data: [55.3, 56.1, 46.3, 57.2, 75.4, 34.7, 37.5, 47.1, 59.6, 71.4]-->
                        <!--}]-->
                        <!--// ,-->
                        <!--// navigation: {-->
                        <!--//     menuItemStyle: {-->
                        <!--//         fontSize: '10px'-->
                        <!--//     }-->
                        <!--// }-->
                    <!--});-->

                    <!--// var testTime = ["","","","","","","","","",""];-->
                        <!--// testPosition = [55.3, 56.1, 46.3, 57.2, 75.4, 34.7, 37.5, 47.1, 59.6, 71.4];-->
                        <!--// testPosition = [0,0,0,0,0,0,0,0,0,0];-->

                    <!--var updateChartReal = function (data){-->

                        <!--// chartTest.hideLoading();-->

                        <!--// 准备数据-->
                        <!--var timestamp = parseInt(data.time);  //获取时间戳-->
                        <!--var date = new Date(timestamp);     //将时间戳转为Date-->
                        <!--// var hhmmss = date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();-->
                        <!--var waterLevel = parseFloat(data.waterLevel);-->
                        <!--// var location = data.siteName;-->

                        <!--// testTime.push(hhmmss);-->
                        <!--// testPosition.push(waterLevel);-->
                        <!--//-->
                        <!--// if (testTime.length >= 10){-->
                        <!--//     testTime.shift();-->
                        <!--//     testPosition.shift();-->
                        <!--// }-->

                        <!--// 更新数据-->
                        <!--// console.log("timestamp = " + timestamp + " waterLevel = " + waterLevel);-->
                        <!--// var xDAta = chartTest.xAxis.data;-->
                        <!--chartReal.series[0].addPoint([timestamp, waterLevel], true, true);-->


                        <!--// chartTest.series[0].addPoint([hhmmss, waterLevel], true, true, true);-->
                        <!--// chartTest.update({-->
                            <!--// legend: {-->
                            <!--//     data: [location]-->
                            <!--// },-->
                            <!--// xAxis: {-->
                            <!--//     data: testTime-->
                            <!--// },-->
                            <!--// series: [{-->
                            <!--//     name: location,-->
                            <!--//     data: testPosition-->
                            <!--// }]-->
                        <!--// });-->

                        <!--// console.log("update series" + testPosition);-->
                        <!--// chartTest.series[0].update({-->
                        <!--//     data: testPosition-->
                        <!--// })-->

                    <!--}-->

                <!--</script>-->



                <!-- 实时监控 -->
                <!--为ECharts准备一个具备大小（宽高）的Dom-->
                <!--<div id="main" style="height:500px;border:1px solid #ccc;padding:10px;"></div>-->
                <!--<script>-->
                    <!--var chartMain = echarts.init(document.getElementById('main'));-->
                    <!--chartMain.setOption({-->
                        <!--title: {-->
                            <!--text: '实时监控'-->
                        <!--},-->
                        <!--tooltip: {},-->
                        <!--legend: {-->
                            <!--data: ' '-->
                        <!--},-->
                        <!--xAxis: {-->
                            <!--name: '时间',-->
                            <!--show: true,-->
                            <!--data: []-->
                        <!--},-->
                        <!--yAxis: {-->
                            <!--name: 'm',-->
                            <!--show: true,-->
                            <!--type: 'value',-->
                            <!--max: 100,-->
                            <!--min: 0-->
                            <!--// axisLabel:{-->
                            <!--//     formatter: '{value} m'-->
                            <!--// }-->
                        <!--},-->
                        <!--series: [{-->
                            <!--name: ' ',-->
                            <!--type: 'line',-->
                            <!--data: []-->
                        <!--}]-->
                    <!--});-->

                    <!--var mainTime = ["","","","","","","","","",""],-->
                        <!--mainPosition = [0,0,0,0,0,0,0,0,0,0];-->


                    <!--//准备好统一的 callback 函数-->
                    <!--var updateChartMain = function (data) { //res是json格式的response对象-->

                        <!--// 隐藏加载动画-->
                        <!--chartMain.hideLoading();-->

                        <!--// 准备数据-->
                        <!--var timestamp = parseInt(data.time);  //获取时间戳-->
                        <!--var date = new Date(timestamp);     //将时间戳转为Date-->
                        <!--var hhmmss = date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();-->
                        <!--var waterLevel = parseFloat(data.waterLevel).toFixed(2);    //截取水位数据仅保留小数点后两位-->
                        <!--var location = data.siteName;-->

                        <!--mainTime.push(hhmmss);-->
                        <!--mainPosition.push(waterLevel);-->

                        <!--if (mainTime.length >= 10){-->
                            <!--mainTime.shift();-->
                            <!--mainPosition.shift();-->
                        <!--}-->

                        <!--// 填入数据-->
                        <!--chartMain.setOption({-->
                            <!--legend: {-->
                                <!--data: [location]-->
                            <!--},-->
                            <!--xAxis: {-->
                                <!--data: mainTime-->
                            <!--},-->
                            <!--series: [{-->
                                <!--name: [location],-->
                                <!--data: mainPosition-->
                            <!--}]-->
                        <!--});-->

                    <!--};-->

                    <!--// 首次显示加载动画-->
                    <!--chartMain.showLoading();-->

                    <!--//图表自适应-->
                    <!--window.addEventListener("resize", function(){-->
                        <!--chartMain.resize();-->
                    <!--})-->

                <!--</script>-->

                <!--<p>-->
                    <!--This is a template for a simple marketing or informational website. It includes a large callout called the hero unit and three supporting pieces of content. Use it as a starting point to create something more unique.-->
                <!--</p>-->
                <p>
                    <a class="btn btn-primary btn-large" onclick="back()">回溯</a>
                 <p>
                    <a class="btn btn-primary btn-large" onclick="real()">实时</a>
                </p></p>
            </div>

            <div class="progress progress-striped active">
                <div class="progress-bar progress-success">
                </div>
            </div>
        </div>
    </div>
    <div class="row clearfix">
        <!-- 图表2 -->
        <div id="left" class="col-md-4 column" style="height:300px;border:1px solid #ccc;padding:10px;">
            <script>
                var chartLeft = echarts.init(document.getElementById('left'));
                chartLeft.setOption({
                    title: {
                        text: '日监控'
                    },
                    tooltip: {},
                    legend: {
                        // data:[''/*, '苏州'*/]
                    },
                    xAxis: {
                        title: {
                          text: '小时'
                        },
                        data: []
                    },
                    yAxis: {
                        name: 'm',
                        show: true,
                        type: 'value',
                        max: 100,
                        min: 0
                        // axisLabel:{
                        //     formatter: '{value} m'
                        // }
                    },
                    series: [{
                        // name: '',
                        type: 'line',
                        data: []
                    }]
                });

                var leftTime = ["","","","","","","","","","","",""],
                    leftPosition = [0,0,0,0,0,0,0,0,0,0,0,0];


                //准备好统一的 callback 函数
                var updateChartLeft = function (data) { //res是json格式的response对象

                    // 隐藏加载动画
                    chartLeft.hideLoading();

                    // 准备数据
                    var timestamp = parseInt(data.time);  //获取时间戳
                    var date = new Date(timestamp);     //将时间戳转为Date
                    var hh = date.getHours();
                    var waterLevel = parseFloat(data.waterLevel).toFixed(2);    //截取水位数据仅保留小数点后两位
                    var location = data.siteName;

                    leftTime.push(hh);
                    leftPosition.push(waterLevel);
                    // console.log("date = " + date + " leftEchart : waterLevel = " + waterLevel);


                    if (leftTime.length >= 12){
                        leftTime.shift();
                        leftPosition.shift();
                    }

                    // 填入数据
                    chartLeft.setOption({
                        legend:{
                            data: [location]
                        },
                        xAxis: {
                            data: leftTime
                        },
                        series: [{
                            // name: '南京',
                            name: [location],
                            data: leftPosition
                        }]
                    });

                };

                // 首次显示加载动画
                chartLeft.showLoading();

                //图表自适应
                window.addEventListener("resize", function(){
                    chartLeft.resize();
                })

            </script>

            <!--<h2>-->
                <!--Heading-->
            <!--</h2>-->
            <!--<p>-->
                <!--Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.-->
            <!--</p>-->
            <p>
                <a class="btn" href="#">View details »</a>
            </p>
        </div>

        <!-- 图表3-->
        <div id="center" class="col-md-4 column" style="height:300px;border:1px solid #ccc;padding:10px;">
            <script>
                var chartCenter = echarts.init(document.getElementById('center'));

                chartCenter.setOption({
                    title: {
                        text: '周监控'
                    },
                    tooltip: {},
                    legend: {
                        data:['南京'/*, '苏州'*/]
                    },
                    xAxis: {
                        // type: 'time',
                        // splitNumber: 24,
                        data: []
                    },
                    yAxis: {
                        type: 'value',
                        max: 100,
                        min: 0,
                        axisLabel:{
                            formatter: '{value} m'
                        }
                    },
                    series: [{
                        name: '南京',
                        type: 'line',
                        data: []
                    }]
                });

                var centerTime = ["","","","","","",""],
                    centerPosition = [0,0,0,0,0,0,0];

                //准备好统一的 callback 函数
                var updateChartCenter= function (data) { //res是json格式的response对象

                    // 隐藏加载动画
                    chartCenter.hideLoading();

                    // 准备数据
                    var timestamp = parseInt(data.time);  //获取时间戳
                    var date = new Date(timestamp);     //将时间戳转为Date
                    var hhmmss = date.getDay();
                    var waterLevel = parseFloat(data.waterLevel).toFixed(2);    //截取水位数据仅保留小数点后两位
                    var location = data.siteName;

                    centerTime.push(hhmmss);
                    centerPosition.push(waterLevel);

                    if (centerTime.length >= 7){
                        centerTime.shift();
                        centerPosition.shift();
                    }

                    // 填入数据
                    chartCenter.setOption({
                        legend: {
                            data: [location]
                        },
                        xAxis: {
                            data: centerTime
                        },
                        series: [{
                            name: [location],
                            data: centerPosition
                        }]
                    });
                };

                // 首次显示加载动画
                chartCenter.showLoading();

                //图表自适应
                window.addEventListener("resize", function(){
                    chartCenter.resize();
                })

            </script>

            <!--<h2>-->
                <!--Heading-->
            <!--</h2>-->
            <!--<p>-->
                <!--Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.-->
            <!--</p>-->
            <p>
                <a class="btn" href="#">View details »</a>
            </p>
        </div>
        <!-- 图表4-->
        <div id="right" class="col-md-4 column" style="height:300px;border:1px solid #ccc;padding:10px;">

            <script>
                var chartRight= echarts.init(document.getElementById('right'));

                chartRight.setOption({
                    title: {
                        text: '月监控'
                    },
                    tooltip: {},
                    legend: {
                        data:['南京'/*, '苏州'*/]
                    },
                    xAxis: {
                        data: []
                    },
                    yAxis: {
                        type: 'value',
                        max: 100,
                        min: 0,
                        axisLabel:{
                            formatter: '{value} m'
                        }
                    },
                    series: [{
                        name: '南京',
                        type: 'line',
                        data: []
                    }]
                });

                var rightTime = ["","","","","","","","","",""],
                    rightPosition = [0,0,0,0,0,0,0,0,0,0];

                //准备好统一的 callback 函数
                var updateChartRight= function (data) { //res是json格式的response对象

                    // 隐藏加载动画
                    chartRight.hideLoading();

                    // 准备数据
                    var timestamp = parseInt(data.time);  //获取时间戳
                    var date = new Date(timestamp);     //将时间戳转为Date
                    var hhmmss = date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();
                    var waterLevel = parseFloat(data.waterLevel).toFixed(2);    //截取水位数据仅保留小数点后两位
                    rightTime.push(hhmmss);
                    rightPosition.push(waterLevel);

                    if (rightTime.length >= 10){
                        rightTime.shift();
                        rightPosition.shift();
                    }

                    // 填入数据
                    chartRight.setOption({
                        legend: {
                            data: [location]
                        },
                        xAxis: {
                            data: rightTime
                        },
                        series: [{
                            name: '南京',
                            data: rightPosition
                        }]
                    });

                };

                // 首次显示加载动画
                chartRight.showLoading();

                //图表自适应
                window.addEventListener("resize", function(){
                    chartRight.resize();
                })
            </script>



            <!--<h2>-->
                <!--Heading-->
            <!--</h2>-->
            <!--<p>-->
                <!--Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.-->
            <!--</p>-->
            <p>
                <a class="btn" href="#">View details »</a>
            </p>
        </div>

        <!-- WebSocket -->
        <script>
            var back = function(){
                console.info("调用back()");
                socket.send("back");
            };

            var real = function(){
                console.info("调用real()");
                socket.send("real");
            };

            //定义socket连接
            var socket;
            function ws() {
                if (window.WebSocket) {
                    socket = new WebSocket("ws://localhost:8080/webSocket");
                    // socket = new WebSocket("ws://192.168.42.183:8080/webSocket");
                    socket.onmessage = function (event) {
                        var datas = JSON.parse(event.data);
                        if (datas[0] == "REAL"){
                            // alert("main");
                            if (datas[1] instanceof Array){
                                console.info("获取预缓存数据");
                                for (var i in datas[1]){
                                    console.info("预缓存数据： " + datas[1][i]);
                                    // updateChartMain(datas[1][i]);
                                    updateChartReal(datas[1][i]);
                                }
                            }else{
                                console.info("收到数据： record( timestmap = " + datas[1].timestamp + ", id = " + datas[1].id + ", siteName = " + datas[1].siteName + ", waterLevel = " + datas[1].waterLevel);
                                // updateChartMain(datas[1]);
                                updateChartReal(datas[1]);
                            }

                        }else if(datas[0] == "HOURLY"){
                            // alert("left");
                            if (datas[1] instanceof Array){
                                // console.info("datas[1] is Array");
                                for (var i in datas[1]){
                                    // alert("datas[1][" + i + "] = " + datas[1][i]);
                                    updateChartLeft(datas[1][i]);
                                }
                            }else{
                                updateChartLeft(datas[1]);
                            }

                        }else if(datas[0] == "WEEKLY"){
                            // alert("center");
                            if (datas[1] instanceof Array) {
                                for (var i in datas[1]) {
                                    updateChartCenter(datas[1][i]);
                                }
                            }else{
                                    updateChartCenter(datas[1]);
                            }
                        }else if(datas[0] == "MONTHLY"){
                            // alert("right");
                            if (datas[1] instanceof Array){
                                for (var i in datas[1]){
                                    updateChartRight(datas[1][i]);
                                }
                            }else{
                                updateChartRight(datas[1]);
                            }

                        }else{
                            alert("error");
                        }

                    };
                    socket.onopen = function (event) {
                        console.info("连接开启");
                    };
                    socket.onclose = function (event) {
                        console.info("连接被关闭");
                    };
                } else {
                    alert("你的浏览器不支持 WebSocket！");
                }

            }

            //建立socket连接，等待服务器“推送”数据，用回调函数更新图表
            $(document).ready(function() {
                namespace = '/test';

                //开始建立WebSocket传输数据
                ws();
            });

        </script>

    </div>
</div>
</body>
</html>