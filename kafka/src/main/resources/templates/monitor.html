<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link href="//cdn.staticfile.org/twitter-bootstrap/3.0.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="v3/layoutit.css" rel="stylesheet">
    <script src="https://img.highcharts.com.cn/jquery/jquery-1.8.3.min.js"></script>
    <script src="https://img.highcharts.com.cn/highcharts/highcharts.js"></script>
    <script src="https://img.highcharts.com.cn/highcharts/modules/exporting.js"></script>
    <script src="https://img.hcharts.cn/highcharts-plugins/highcharts-zh_CN.js"></script>
    <script src="http://echarts.baidu.com/dist/echarts.min.js"></script>
</head>
<body>

<div class="container">
    <div class="row clearfix">
        <div class="col-md-12 column">
            <nav class="navbar navbar-default" role="navigation">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"> <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button> <a class="navbar-brand" href="#">Brand</a>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="#">Link</a>
                        </li>
                        <li>
                            <a href="#">Link</a>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown<strong class="caret"></strong></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="#">Action</a>
                                </li>
                                <li>
                                    <a href="#">Another action</a>
                                </li>
                                <li>
                                    <a href="#">Something else here</a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="#">Separated link</a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="#">One more separated link</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                    <form class="navbar-form navbar-left" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control" />
                        </div> <button type="submit" class="btn btn-default">Submit</button>
                    </form>
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#">Link</a>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown<strong class="caret"></strong></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="#">Action</a>
                                </li>
                                <li>
                                    <a href="#">Another action</a>
                                </li>
                                <li>
                                    <a href="#">Something else here</a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="#">Separated link</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>

            </nav>



            <div class="jumbotron">

                <!-- 动态图表 -->
                <!--为ECharts准备一个具备大小（宽高）的Dom-->
                <div id="main" style="height:500px;border:1px solid #ccc;padding:10px;"></div>
                <script>
                    var chartMain = echarts.init(document.getElementById('main'));
                    chartMain.setOption({
                        title: {
                            text: '水位实时监控'
                        },
                        tooltip: {},
                        legend: {
                            data:['南京']
                        },
                        xAxis: {
                            data: []
                        },
                        yAxis: {
                            type: 'value',
                            max: 100,
                            min: 0,
                            axisLabel:{
                                formatter: '{value} m'
                            }
                        },
                        series: [{
                            name: '南京',
                            type: 'line',
                            data: []
                        }]
                    });

                    var time = ["","","","","","","","","",""],
                        position1 = [0,0,0,0,0,0,0,0,0,0]


                    //准备好统一的 callback 函数
                    var updateChartMain = function (data) { //res是json格式的response对象

                        // 隐藏加载动画
                        chartMain.hideLoading();

                        // 准备数据
                        var timestamp = parseInt(data.time);  //获取时间戳
                        var date = new Date(timestamp);     //将时间戳转为Date
                        var hhmmss = date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();
                        var waterLevel = parseFloat(data.waterLevel).toFixed(2);    //截取水位数据仅保留小数点后两位
                        time.push(hhmmss);
                        position1.push(waterLevel);

                        if (time.length >= 10){
                            time.shift();
                            position1.shift();
                        }

                        // 填入数据
                        chartMain.setOption({
                            xAxis: {
                                data: time
                            },
                            series: [{
                                name: '南京',
                                data: position1
                            }]
                        });

                    };

                    // 首次显示加载动画
                    chartMain.showLoading();

                    //图表自适应
                    window.addEventListener("resize", function(){
                        chartMain.resize();
                    })

                </script>

                <p>
                    This is a template for a simple marketing or informational website. It includes a large callout called the hero unit and three supporting pieces of content. Use it as a starting point to create something more unique.
                </p>
                <p>
                    <a class="btn btn-primary btn-large" href="#">Learn more</a>
                </p>
            </div>
            <div class="progress progress-striped active">
                <div class="progress-bar progress-success">
                </div>
            </div>
        </div>
    </div>
    <div class="row clearfix">
        <!-- 图表2 -->
        <div id="left" class="col-md-4 column" style="height:300px;border:1px solid #ccc;padding:10px;">
            <script>
                var chartLeft = echarts.init(document.getElementById('left'));
                chartLeft.setOption({
                    title: {
                        text: '水位实时监控'
                    },
                    tooltip: {},
                    legend: {
                        data:['南京'/*, '苏州'*/]
                    },
                    xAxis: {
                        // type: 'time',
                        // splitNumber: 24,
                        data: []
                    },
                    yAxis: {
                        type: 'value',
                        max: 100,
                        min: 0,
                        axisLabel:{
                            formatter: '{value} m'
                        }
                    },
                    series: [{
                        name: '南京',
                        type: 'line',
                        data: []
                    }]
                });

                var time = ["","","","","","","","","",""],
                    position1 = [0,0,0,0,0,0,0,0,0,0]


                //准备好统一的 callback 函数
                var updateChartLeft = function (data) { //res是json格式的response对象

                    // 隐藏加载动画
                    chartLeft.hideLoading();

                    // 准备数据
                    var timestamp = parseInt(data.time);  //获取时间戳
                    var date = new Date(timestamp);     //将时间戳转为Date
                    var hhmmss = date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();
                    var waterLevel = parseFloat(data.waterLevel).toFixed(2);    //截取水位数据仅保留小数点后两位
                    time.push(hhmmss);
                    position1.push(waterLevel);

                    if (time.length >= 10){
                        time.shift();
                        position1.shift();
                    }

                    // 填入数据
                    chartLeft.setOption({
                        xAxis: {
                            data: time
                        },
                        series: [{
                            name: '南京',
                            data: position1
                        }]
                    });

                };

                // 首次显示加载动画
                chartLeft.showLoading();

                //图表自适应
                window.addEventListener("resize", function(){
                    chartLeft.resize();
                })

            </script>

            <h2>
                Heading
            </h2>
            <p>
                Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
            </p>
            <p>
                <a class="btn" href="#">View details »</a>
            </p>
        </div>

        <!-- 图表3-->
        <div id="center" class="col-md-4 column" style="height:300px;border:1px solid #ccc;padding:10px;">
            <script>
                var chartCenter = echarts.init(document.getElementById('center'));

                chartCenter.setOption({
                    title: {
                        text: '水位实时监控'
                    },
                    tooltip: {},
                    legend: {
                        data:['南京'/*, '苏州'*/]
                    },
                    xAxis: {
                        // type: 'time',
                        // splitNumber: 24,
                        data: []
                    },
                    yAxis: {
                        type: 'value',
                        max: 100,
                        min: 0,
                        axisLabel:{
                            formatter: '{value} m'
                        }
                    },
                    series: [{
                        name: '南京',
                        type: 'line',
                        data: []
                    }]
                });

                var time = ["","","","","","","","","",""],
                    position1 = [0,0,0,0,0,0,0,0,0,0]

                //准备好统一的 callback 函数
                var updateChartCenter= function (data) { //res是json格式的response对象

                    // 隐藏加载动画
                    chartCenter.hideLoading();

                    // 准备数据
                    var timestamp = parseInt(data.time);  //获取时间戳
                    var date = new Date(timestamp);     //将时间戳转为Date
                    var hhmmss = date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();
                    var waterLevel = parseFloat(data.waterLevel).toFixed(2);    //截取水位数据仅保留小数点后两位
                    time.push(hhmmss);
                    position1.push(waterLevel);

                    if (time.length >= 10){
                        time.shift();
                        position1.shift();
                    }

                    // 填入数据
                    chartCenter.setOption({
                        xAxis: {
                            data: time
                        },
                        series: [{
                            name: '南京',
                            data: position1
                        }]
                    });
                };

                // 首次显示加载动画
                chartCenter.showLoading();

                //图表自适应
                window.addEventListener("resize", function(){
                    chartCenter.resize();
                })

            </script>

            <h2>
                Heading
            </h2>
            <p>
                Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
            </p>
            <p>
                <a class="btn" href="#">View details »</a>
            </p>
        </div>
        <!-- 图表4-->
        <div id="right" class="col-md-4 column" style="height:300px;border:1px solid #ccc;padding:10px;">
            <script>
                var chartRight= echarts.init(document.getElementById('right'));

                chartRight.setOption({
                    title: {
                        text: '水位实时监控'
                    },
                    tooltip: {},
                    legend: {
                        data:['南京'/*, '苏州'*/]
                    },
                    xAxis: {
                        // type: 'time',
                        // splitNumber: 24,
                        data: []
                    },
                    yAxis: {
                        type: 'value',
                        max: 100,
                        min: 0,
                        axisLabel:{
                            formatter: '{value} m'
                        }
                    },
                    series: [{
                        name: '南京',
                        type: 'line',
                        data: []
                    }]
                });

                var time = ["","","","","","","","","",""],
                    position1 = [0,0,0,0,0,0,0,0,0,0]

                //准备好统一的 callback 函数
                var updateChartRight= function (data) { //res是json格式的response对象

                    // 隐藏加载动画
                    chartRight.hideLoading();

                    // 准备数据
                    var timestamp = parseInt(data.time);  //获取时间戳
                    var date = new Date(timestamp);     //将时间戳转为Date
                    var hhmmss = date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();
                    var waterLevel = parseFloat(data.waterLevel).toFixed(2);    //截取水位数据仅保留小数点后两位
                    time.push(hhmmss);
                    position1.push(waterLevel);

                    if (time.length >= 10){
                        time.shift();
                        position1.shift();
                    }

                    // 填入数据
                    chartRight.setOption({
                        xAxis: {
                            data: time
                        },
                        series: [{
                            name: '南京',
                            data: position1
                        }]
                    });

                };

                // 首次显示加载动画
                chartRight.showLoading();

                //图表自适应
                window.addEventListener("resize", function(){
                    chartRight.resize();
                })


                //建立socket连接，等待服务器“推送”数据，用回调函数更新图表
                $(document).ready(function() {
                    namespace = '/test';

                    function ws() {
                        var socket;
                        if (window.WebSocket) {
                            // socket = new WebSocket("ws://127.0.0.1:8080/webSocket");
                            socket = new WebSocket("ws://192.168.42.183:8080/webSocket");
                            socket.onmessage = function (event) {
                                var datas = JSON.parse(event.data);
                                if (datas[0] == "main"){
                                    // alert("main");
                                    updateChartMain(datas[1]);

                                }else if(datas[0] == "left"){
                                    // alert("left");
                                    updateChartLeft(datas[1]);

                                }else if(datas[0] == "center"){
                                    // alert("center");
                                    updateChartCenter(datas[1]);
                                }else if(datas[0] == "right"){
                                    // alert("right");
                                    updateChartRight(datas[1]);

                                }else{
                                    alert("error");
                                }


                                // if (datas instanceof Array){    //第一次传入的是预缓存数据数组，用于填充表格
                                //     var i = 0;
                                //     for (var data in datas){
                                //         update_mychart(datas[data]);
                                //     }
                                // }else{      //实时数据
                                //     update_mychart(datas);
                                // }
                            };
                            socket.onopen = function (event) {
                                console.info("连接开启");
                            };
                            socket.onclose = function (event) {
                                console.info("连接被关闭");
                            };
                        } else {
                            alert("你的浏览器不支持 WebSocket！");
                        };

                    }

                    //开始建立WebSocket传输数据
                    ws();
                });

            </script>

            <h2>
                Heading
            </h2>
            <p>
                Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
            </p>
            <p>
                <a class="btn" href="#">View details »</a>
            </p>
        </div>
    </div>
</div>
</body>
</html>